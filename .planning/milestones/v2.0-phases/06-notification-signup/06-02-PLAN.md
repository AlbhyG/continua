---
phase: 06-notification-signup
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/dialogs/SignupDialog.tsx
  - src/components/layout/Header.tsx
autonomous: false

must_haves:
  truths:
    - "User can open Sign In/Up dialog from header button"
    - "User sees inline validation errors for invalid name or email without page reload"
    - "User with screen reader hears error announcements via ARIA live regions"
    - "User sees 'check your email' confirmation message after successful signup"
    - "Dialog closes only via manual close (X or click outside), not auto-close"
    - "Submit button is disabled until both fields are valid"
  artifacts:
    - path: "src/components/dialogs/SignupDialog.tsx"
      provides: "Signup dialog with form, validation, ARIA errors, confirmation"
      contains: "useActionState"
    - path: "src/components/layout/Header.tsx"
      provides: "Header with Sign In/Up button that opens SignupDialog"
      contains: "SignupDialog"
  key_links:
    - from: "src/components/layout/Header.tsx"
      to: "src/components/dialogs/SignupDialog.tsx"
      via: "import and state toggle"
      pattern: "import SignupDialog"
    - from: "src/components/dialogs/SignupDialog.tsx"
      to: "src/app/actions/signup.ts"
      via: "useActionState with signupAction"
      pattern: "useActionState.*signupAction"
    - from: "src/components/dialogs/SignupDialog.tsx"
      to: "src/lib/validations/signup.ts"
      via: "import signupSchema for client validation"
      pattern: "import.*signupSchema.*from.*validations/signup"
---

<objective>
Build the SignupDialog component with on-blur validation, ARIA live regions, and confirmation state, then wire the header Sign In/Up button to open it.

Purpose: This is the user-facing delivery of Phase 6 — the dialog that collects name + email, validates inline, submits via Server Action, and shows "check your email" confirmation.

Output: Fully functional signup dialog accessible from the header button.
</objective>

<execution_context>
@/Users/shantam/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shantam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-notification-signup/06-RESEARCH.md
@.planning/phases/06-notification-signup/06-01-SUMMARY.md

# Key codebase references
@src/components/layout/Header.tsx
@src/components/dialogs/PublishersDialog.tsx
@src/app/actions/signup.ts
@src/lib/validations/signup.ts
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SignupDialog component with validation and confirmation</name>
  <files>src/components/dialogs/SignupDialog.tsx</files>
  <action>
Create `src/components/dialogs/SignupDialog.tsx` as a Client Component.

**Architecture:**
- Use Headless UI Dialog (matches existing dialog pattern from PublishersDialog.tsx)
- Centered modal overlay (Claude's discretion: modal chosen for simplicity and familiarity)
- `useActionState` from React 19 for Server Action integration
- `useFormStatus` in a child SubmitButton component (MUST be child of form, not sibling)
- Client-side on-blur validation using signupSchema from shared validations
- Two states: form view and confirmation view (same dialog, content swaps)

**Props interface:**
```typescript
interface SignupDialogProps {
  isOpen: boolean
  onClose: () => void
}
```

**Form view requirements (from locked user decisions):**
- Two fields: Name (text) and Email (email) — single name field, NOT first/last split
- Validation triggers on blur (when user leaves field)
- Error messages appear below each field as text only — NO red border or visual field indicator
- Submit button disabled until BOTH fields touched AND valid
- ARIA live regions: each error message has `role="alert"` and `aria-live="polite"`
- Each input has `aria-invalid` (boolean) and `aria-describedby` pointing to error `id` when error exists
- Loading state: button text changes to "Signing up..." when pending (Claude's discretion)

**Confirmation view requirements (from locked user decisions):**
- On successful submit (`state?.success === true`), replace form content with confirmation
- Same dialog stays open (no close, no redirect)
- Message: "Check your email" heading with supporting text like "We've sent a verification link to your email address."
- Dialog closes only via X button or clicking outside (manual close) — NO auto-close

**Client-side validation logic:**
- Import `signupSchema` from `@/lib/validations/signup` for DRY validation
- On blur, use `signupSchema.shape.name.safeParse(value)` and `signupSchema.shape.email.safeParse(value)` to validate individual fields
- Track `touched` state per field: `{ name: false, email: false }`
- Track `clientErrors` per field: `{ name: '', email: '' }`
- `isValid = touched.name && touched.email && !clientErrors.name && !clientErrors.email`

**Styling (match existing dialog pattern from PublishersDialog.tsx):**
- Dialog: `className="relative z-[60]"`
- DialogBackdrop: `className="fixed inset-0 bg-black/30 backdrop-blur-sm z-[60]"`
- Wrapper div: `className="fixed inset-0 z-[60] flex items-center justify-center p-4"`
- DialogPanel: `className="max-w-md w-full rounded-xl bg-white/95 backdrop-blur shadow-lg p-6"`
- DialogTitle: `className="text-lg font-bold text-foreground"`
- Inputs: `className="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-accent"` (matches PublishersDialog inputs)
- Labels: `className="block text-sm font-medium text-foreground mb-1"`
- Error text: `className="text-sm text-red-600 mt-1"` (text only, no border changes on input)
- Submit button: `className="w-full rounded-full bg-accent text-white font-bold py-2 hover:bg-accent/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"` (primary/filled style per user decision)
- Close button in confirmation: same accent style as PublishersDialog close button

**Important implementation notes:**
- SubmitButton MUST be a separate child component of the form (useFormStatus requirement)
- When dialog closes, reset form state (touched, clientErrors) so reopening shows fresh form
- If `state?.success` was true and dialog closes, reset state on next open (use useEffect or onClose handler)
- Always show form for Phase 6 (returning user detection deferred — Claude's discretion: always show form, upsert handles duplicates)
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Component exports default function SignupDialog
    - Component imports signupAction from '@/app/actions/signup'
    - Component imports signupSchema from '@/lib/validations/signup'
    - Component uses useActionState, useFormStatus, Dialog from @headlessui/react
    - Error elements have role="alert" and aria-live="polite"
    - Inputs have aria-invalid and aria-describedby attributes
  </verify>
  <done>SignupDialog renders form with on-blur validation, ARIA live regions for errors, disabled submit until valid, pending state on submit, and confirmation view on success</done>
</task>

<task type="auto">
  <name>Task 2: Wire Header Sign In/Up button to open SignupDialog</name>
  <files>src/components/layout/Header.tsx</files>
  <action>
Update `src/components/layout/Header.tsx`:

1. **Import SignupDialog:**
   ```typescript
   import SignupDialog from '@/components/dialogs/SignupDialog'
   ```

2. **Add state for dialog visibility** (follow existing pattern — same as showPublishers/showAgents/showTherapists):
   ```typescript
   const [showSignup, setShowSignup] = useState(false)
   ```

3. **Update the Sign In button** (lines 166-171) to open the dialog:
   - Change button text from "Sign In" to "Sign In / Up" (matches requirement NAV-03)
   - Keep the existing styling: `rounded-full bg-white/20 backdrop-blur px-4 py-1.5 text-sm font-bold text-white hover:bg-white/35 transition-colors` (this is the current styling; the primary/filled style decision means it should stand out — the current white/20 on accent header IS the filled CTA style in this design system)
   - Add onClick: `onClick={() => setShowSignup(true)}`

4. **Render SignupDialog** alongside existing dialogs (after TherapistsDialog):
   ```tsx
   <SignupDialog isOpen={showSignup} onClose={() => setShowSignup(false)} />
   ```

No other changes to Header.tsx. The button styling stays as-is because within the accent-colored header bar, the white/20 pill IS the primary call-to-action style. If the user wants a more prominent style (e.g., solid white background), that's a visual tweak for the checkpoint.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` succeeds
    - Header.tsx imports SignupDialog
    - Header.tsx has showSignup state
    - Sign In/Up button has onClick handler
    - SignupDialog rendered in Header component
  </verify>
  <done>Header button opens SignupDialog on click, dialog renders with form, all existing navigation unchanged</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify signup dialog end-to-end</name>
  <files>None (verification only)</files>
  <action>
Human verifies the complete notification signup flow built in Tasks 1-2.

**What was built:** Complete notification signup flow — header button opens dialog, form validates on blur with accessible error messages, submits to database via Server Action, shows "check your email" confirmation.

**Verification steps:**
1. Run `npm run dev` and open http://localhost:3000
2. **Dialog opens:** Click "Sign In / Up" button in header. Dialog should appear as centered modal overlay.
3. **Validation on blur:**
   - Click the Name field, leave it empty, tab to Email field. Error "Name is required" should appear below Name field.
   - Click the Email field, type "notanemail", tab out. Error "Please enter a valid email address" should appear below Email field.
   - Submit button should be disabled (grayed out) while errors exist.
4. **Valid input enables submit:**
   - Enter a valid name (e.g., "Test User") in Name field (tab out to trigger validation).
   - Enter a valid email (e.g., "test@example.com") in Email field (tab out).
   - Submit button should become enabled (no longer grayed out).
5. **Successful submission:**
   - Click the submit button. Button should show "Signing up..." briefly.
   - Dialog should replace form with "Check your email" confirmation message.
   - Dialog should NOT auto-close.
6. **Manual close:** Click outside the dialog or press Escape. Dialog should close.
7. **Database persistence:** Check Supabase Dashboard > Table Editor > contacts. The submitted name and email should appear.
8. **Duplicate handling:** Reopen dialog, submit same email again. Should show same "check your email" confirmation (not an error).
9. **Screen reader (optional):** If available, verify error messages are announced when they appear.

**Resume signal:** Type "approved" or describe any issues to fix.
  </action>
  <verify>User confirms all verification steps pass</verify>
  <done>User has approved the signup dialog flow works correctly end-to-end</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. All existing routes (/, /who, /what) still work
3. Sign In/Up button in header opens signup dialog
4. Form validates name and email on blur with error text below fields
5. Error messages have ARIA attributes (role="alert", aria-live="polite")
6. Submit button disabled until both fields valid
7. Successful submission shows "check your email" confirmation in same dialog
8. Duplicate email submission shows same confirmation (privacy-safe)
9. Dialog closes only via manual close (X, click outside, Escape)
</verification>

<success_criteria>
Phase 6 success criteria (ALL must be TRUE):
1. User can open Sign In/Up dialog from header button
2. User sees inline validation errors for invalid name or email without page reload
3. User with screen reader hears error announcements via ARIA live regions
4. User's signup data persists in database after form submission
5. User sees "check your email" confirmation message after successful signup
</success_criteria>

<output>
After completion, create `.planning/phases/06-notification-signup/06-02-SUMMARY.md`
</output>
